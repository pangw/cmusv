<% content_for :title, 'People' %>

<% content_for :tablesorter do %>
  <%= javascript_include_tag 'tablesorter' %>
  <%= javascript_include_tag 'tablesorter_filter' %>
<script type="text/javascript">
$(document).ready(function() 
    {
       if ($("#filterBoxOne").attr("disabled") == true)
       {
         $('#filterBoxOne').val('');
         $('#filterBoxOne').removeAttr("disabled");
         $('#filterBoxOne').focus();
        }
        $("#people_table").tablesorter({widgets: ['zebra'],         
                                        headers: {2: {sorter: false}  },
                                        sortList: [[0,0], [1,0]]})
            .tablesorterFilter({ filterContainer: $("#filterBoxOne"),
                filterClearContainer: $("#filterClearOne"),
                filterColumns: [0, 1, 3, 4, 5],
                filterCaseSensitive: false
            });        

        //scroll the message box to the top offset of browser's scrool bar
        $(window).scroll(function()
        {
          $('#image_box').animate({top:$(window).scrollTop()+"px" },{queue: false, duration: 350});
        });
        //when the close button at right corner of the message box is clicked
        $('#close_image_box').click(function()
        {
          //the messagebox gets scrool down with top property and gets hidden with zero opacity
          $('#image_box').animate({ top:"+=15px",opacity:0 }, "slow");
        });

        //hoving over a line selects it
        $("tr").hover(
        function () {
          $(this).addClass("hover");
        },
        function () {
          $(this).removeClass("hover");
        });
      }
);

function toggleStudents()
{
  /* we don't use .toggle since the state may be inaccurate from a page reload */
  if ($('#student_checkbox').is(':checked')) {
    $(".student").show();
  } else {
    $(".student").hide();
  }
  $("#filterBoxOne").trigger("keyup");
}

function toggleStaff()
{
  if ($('#staff_checkbox').is(':checked')) {
    $(".staff").show();
  } else {
    $(".staff").hide();
  }
  $("#filterBoxOne").trigger("keyup");
}

function updateImage(uri,label)
{
 $('#image_box_image').attr("src", uri);

 $('#image_box_label').text(label);
}

</script>
<% end %>

<h1>Listing people</h1>
<div class="right_link" ><%= link_to 'See phone book', :action=>'phone_book' %><br/><%= link_to 'See photo book', :action=>'photo_book' %></div>
<div style="float:none"><%= render :partial => "tablesorter_filter_box" %><label>Show Students</label><input type="checkbox" id="student_checkbox" onchange="toggleStudents()" value="1" checked="checked" />
  <label>Show Staff</label><input type="checkbox" id="staff_checkbox" onchange="toggleStaff()" value="1" checked="checked" />
</div>

<div id="image_box">
  <%= image_tag("/images/mascot.jpg", :width=>"150", :alt=>"Temporary Picture", :id=>"image_box_image")%><%= image_tag("/images/tablesorter/cross.png", :width=>"16", :height=>"16", :alt=>"Close Me", :style=>"float:right;cursor:pointer", :id=>"close_image_box") %>
  <div id='image_box_label'></div>
</div>
<table>
  <tr>
    <td>
      <%= check_box :colums, :phone_num %>
    </td>
    <td>
    <%= label :columns, :phone_num, "Phone Number" %>
    </td>
  <td>
    <%= text_field_tag :phone_num %>
    </td>
  </tr>
  <tr>
    <td>
    <%= check_box :colums, :has_email %>
    </td>
    <td>
    <%= label :columns, :has_email, "Email" %>
    </td>
    <td>
    <%= text_field_tag :has_email %>
    </td>
  </tr>
  <tr>

    <td><%= check_box :colums, :has_tigris %></td>
    <td><%= label :columns, :has_tigris, "Tigris" %></td>
    <td><%= text_field_tag :has_tigris %></td>
  </tr>
  <tr>

    <td><%= check_box :colums, :local_near_remote %></td>
    <td><%= label :columns, :local_near_remote, "Is local" %></td>
    <td><%= text_field_tag :local_near_remote %></td>
  </tr>
  <tr>

    <td><%= check_box :colums, :city_state %></td>
    <td><%= label :columns, :city_state, "City/State" %></td>
    <td><%= text_field_tag :city_state %></td>
  </tr>
  <tr>

    <td><%= check_box :colums, :track %></td>
    <td><%= label :columns, :track, "Track" %></td>
    <td><%= text_field_tag :track %></td>
  </tr>
  <tr>

    <td><%= check_box :colums, :is_pt %></td>
    <td><%= label :columns, :is_pt, "Is Part-time" %></td>
    <td><%= text_field_tag :is_pt %></td>
  </tr>
  <tr>

    <td><%= check_box :colums, :active %></td>
    <td><%= label :columns, :active, "Is Active" %></td>
    <td><%= text_field_tag :active %></td>
  </tr>
  <tr>

    <td><%= check_box :colums, :has_image %></td>
    <td><%= label :columns, :has_image, "Has Image" %></td>
    <td></td>
  </tr>
  <tr>

    <td><%= check_box :colums, :course %></td>
    <td><%= label :columns, :course, "Course" %></td>
    <td><%= text_field_tag :course %></td>
  </tr>
  <tr>

    <td><%= check_box :colums, :semester %></td>
    <td><%= label :columns, :semester, "Semester" %></td>
    <td><%= text_field_tag :semester %></td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td>
      <%= button_to "Search" %></td>
    <td>
      <%= button_to "Cancel" %>
    </td>
  </tr>

</table>

<div id="filtered_people_table">
  <%= render :partial => "show_filtered_people"  %>
</div>
<br />

<% if current_user && (current_user.is_admin? || current_user.is_staff?) %>
<%= link_to 'New person', new_person_path %>
<% end %>
